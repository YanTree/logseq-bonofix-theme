/*****************************************
  Code Mirror
*****************************************/

// unset solarized
.cm-s-solarized,
.cm-s-solarized.cm-s-light,
.cm-s-solarized.cm-s-dark {
  background-color: var(--bf-codeblock-background-color);
  text-shadow: unset;

  &.CodeMirror {
    -moz-box-shadow: unset;
    -webkit-box-shadow: unset;
    box-shadow: unset;
  }

  .CodeMirror-gutters {
    background-color: var(--bf-codeblock-background-color);
  }

  .CodeMirror-linenumber {
    text-shadow: unset;
  }
}

/* With accent */

// line number in custom accent
.cm-s-lsradix.cm-s-light,
.cm-s-lsradix.cm-s-dark {
  .CodeMirror-gutters {
    background-color: inherit;
  }
}

/* theme general */

.extensions__code {
  display: block;
  background-color: var(--bf-codeblock-background-color); // calculator result
  border-radius: 0.25rem; // with .CodeMirror

  .code-editor {
    margin: 0.5rem 0;
  }

  .extensions__code-lang {
    margin-right: 7px;
    margin-top: 7px;
    padding: unset;
    background-color: unset;
    opacity: 0.6;
  }

  textarea {
    color: var(--ls-primary-text-color);
    background-color: var(--bf-codeblock-background-color);
  }

  .CodeMirror {
    color: var(--ls-secondary-text-color);
    background-color: var(--bf-codeblock-background-color);
    font-family: SFMono-Regular, Consolas, "Liberation Mono", Menlo, Courier, monospace;
    padding: 0px 10px 0px 20px;
    border-radius: 0.25rem;

    &::before {
      content: "";
      background: url("data:image/png;base64,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");
      height: 1rem;
      width: 100%;
      background-size: 2.5rem;
      background-repeat: no-repeat;
      margin: 0.5rem .0px .0px -0.4rem;
      position: absolute;
      z-index: 4;
    }

    .CodeMirror-sizer .CodeMirror-lines {
      .CodeMirror-cursors .CodeMirror-cursor {
        border-left: solid thin #82aaff;
      }
    }
  }
}

/* Missing properties in Logseq v0.7.x */
.CodeMirror-lines {
  padding: 4px 0; // rewrite in case of future changes
}

.CodeMirror-scroll {
  padding-top: 24px; // rewrite in case of future changes
  padding-bottom: 66px;
}

.extensions__code-calc {
  padding-top: 22px; // Code-Mirror-lines(4px) + Code-Mirror-scroll(18px)
  padding-right: 22px;
}

/* Right side bar */
.white-theme {
  .cp__right-sidebar {
    .CodeMirror,
    .CodeMirror-gutters,
    .extensions__code-lang {
      background-color: rgba(242, 241, 238, 0.95);
    }
  }
}

/* Rewrite .cm-s-solarized */
/* Syntax colors */

.cm-s-solarized,
.cm-s-lsradix {
  // Common & Dark

  .CodeMirror-matchingbracket {
    text-decoration: underline;
    color: rgb(91, 223, 223) !important;
  }

  span.cm-comment {
    color: #a0a0a0;
  }

  span.cm-string,
  span.cm-string-2 {
    color: #e6c963;
  }

  span.cm-number {
    color: #978ade;
  }

  span.cm-variable {
    color: #82aaff;
  }

  span.cm-variable-2 {
    color: rgba(255, 255, 255, 0.7);
  }

  span.cm-def {
    color: var(--ls-secondary-text-color);
  }

  span.cm-operator {
    color: #f15f60;
  }

  span.cm-keyword {
    color: #f15f60;
  }

  span.cm-atom {
    color: #978ade;
  }

  span.cm-meta {
    color: white;
  }

  span.cm-tag {
    color: #f07178;
  }

  span.cm-attribute {
    color: #c792ea;
  }

  span.cm-qualifier {
    color: #41b394;
  }

  span.cm-property {
    color: #9bd174;
  }

  span.cm-builtin {
    color: #45add6;
  }

  span.cm-variable-3,
  span.cm-type {
    color: darkorange;
  }
}

.white-theme .cm-s-solarized,
.white-theme .cm-s-lsradix {
  span.cm-string,
  span.cm-string-2 {
    color: darkorange;
  }

  span.cm-variable-2 {
    color: rgba(0, 0, 0, 0.7);
  }

  span.cm-def {
    color: var(--ls-secondary-text-color);
  }

  span.cm-meta {
    color: var(--ls-secondary-text-color);
  }
}

/* Active line in cm-s-solarized */
.cm-s-solarized.cm-s-dark {
  .CodeMirror-activeline-background {
    background: rgba(0, 0, 0, 0.1);
  }
  .CodeMirror-linenumber {
    color: #586375;
  }
}

.cm-s-solarized.cm-s-light {
  .CodeMirror-activeline-background {
    background: rgba(0, 0, 0, 0.05);
  }
}

/* Selection */
.dark-theme {
  .cm-s-solarized,
  .cm-s-lsradix {
    &.cm-s-dark {
      &.CodeMirror ::selection {
        background: rgba(255, 255, 255, 0.1);
      }

      div.CodeMirror-selected {
        background: rgba(255, 255, 255, 0.1);
      }
      .CodeMirror-line::selection,
      .CodeMirror-line::-moz-selection {
        background: rgba(255, 255, 255, 0.1);
      }
    }
  }

  .cm-s-dark {
    .CodeMirror-line > span::selection,
    .CodeMirror-line > span::-moz-selection,
    .CodeMirror-line > span > span::selection,
    .CodeMirror-line > span > span::-moz-selection {
      background: rgba(255, 255, 255, 0.1);
    }
  }

  // // Switch from white theme, fix bug in old version
  // .cm-s-solarized.cm-s-light div.CodeMirror-selected {
  //   background: rgba(255, 255, 255, 0.1);
  // }
  // .cm-s-solarized.cm-s-light .CodeMirror-line::selection,
  // .cm-s-light .CodeMirror-line > span::selection,
  // .cm-s-light .CodeMirror-line > span > span::selection {
  //   background: rgba(255, 255, 255, 0.1);
  // }
  // .cm-s-solarized.cm-s-light .CodeMirror-line::-moz-selection,
  // .cm-s-light .CodeMirror-line > span::-moz-selection,
  // .cm-s-light .CodeMirror-line > span > span::-moz-selection {
  //   background: rgba(255, 255, 255, 0.1);
  // }
}

.white-theme {
  .cm-s-solarized,
  .cm-s-lsradix {
    &.cm-s-light {
      div.CodeMirror-selected {
        background: rgba(168, 175, 255, 0.2);
      }
      .CodeMirror-line::selection,
      .CodeMirror-line::-moz-selection {
        background: rgba(168, 175, 255, 0.2);
      }
  }
  }

  // Switch from dark theme
  .cm-s-solarized.cm-s-dark div.CodeMirror-selected {
    background: rgba(168, 175, 255, 0.2);
    }

  // Switch from dark theme
  .cm-s-solarized.cm-s-dark div.CodeMirror-selected {
    background: rgba(168, 175, 255, 0.2);
  }

  .cm-s-light {
    .CodeMirror-line > span::selection,
    .CodeMirror-line > span::-moz-selection,
    .CodeMirror-line > span > span::selection,
    .CodeMirror-line > span > span::-moz-selection  {
      background: rgba(168, 175, 255, 0.2);
    }
  }

  // // Switch from dark theme, fix bug in old version
  // .cm-s-solarized.cm-s-dark div.CodeMirror-selected {
  //   background: rgba(168, 175, 255, 0.2);
  // }

  // .cm-s-solarized.cm-s-dark.CodeMirror ::selection {
  //   background: rgba(168, 175, 255, 0.2);
  // }

  // .cm-s-solarized.cm-s-dark .CodeMirror-line::-moz-selection,
  // .cm-s-dark .CodeMirror-line > span::-moz-selection,
  // .cm-s-dark .CodeMirror-line > span > span::-moz-selection {
  //   background: rgba(168, 175, 255, 0.2);
  // }
}